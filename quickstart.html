<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Creating APIs in R with Plumber</title>
  <meta name="description" content="Use the plumber R package to create HTTP APIs in R.">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Creating APIs in R with Plumber" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Use the plumber R package to create HTTP APIs in R." />
  <meta name="github-repo" content="trestletech/apis-plumber" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Creating APIs in R with Plumber" />
  
  <meta name="twitter:description" content="Use the plumber R package to create HTTP APIs in R." />
  

<meta name="author" content="Jeff Allen">


<meta name="date" content="2017-06-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="routing-and-input.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Creating APIs in R with Plumber</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#web-apis"><i class="fa fa-check"></i><b>1.1</b> Web APIs</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quickstart.html"><a href="quickstart.html"><i class="fa fa-check"></i><b>2</b> Quickstart</a><ul>
<li class="chapter" data-level="2.1" data-path="quickstart.html"><a href="quickstart.html#specifying-the-inputs"><i class="fa fa-check"></i><b>2.1</b> Specifying the Inputs</a></li>
<li class="chapter" data-level="2.2" data-path="quickstart.html"><a href="quickstart.html#customizing-the-output"><i class="fa fa-check"></i><b>2.2</b> Customizing The Output</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="routing-and-input.html"><a href="routing-and-input.html"><i class="fa fa-check"></i><b>3</b> Routing &amp; Input</a><ul>
<li class="chapter" data-level="3.1" data-path="routing-and-input.html"><a href="routing-and-input.html#routing"><i class="fa fa-check"></i><b>3.1</b> Routing</a><ul>
<li class="chapter" data-level="3.1.1" data-path="routing-and-input.html"><a href="routing-and-input.html#endpoints"><i class="fa fa-check"></i><b>3.1.1</b> Endpoints</a></li>
<li class="chapter" data-level="3.1.2" data-path="routing-and-input.html"><a href="routing-and-input.html#dynamic-routes"><i class="fa fa-check"></i><b>3.1.2</b> Dynamic Routes</a></li>
<li class="chapter" data-level="3.1.3" data-path="routing-and-input.html"><a href="routing-and-input.html#typed-dynamic-routes"><i class="fa fa-check"></i><b>3.1.3</b> Typed Dynamic Routes</a></li>
<li class="chapter" data-level="3.1.4" data-path="routing-and-input.html"><a href="routing-and-input.html#filters"><i class="fa fa-check"></i><b>3.1.4</b> Filters</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="routing-and-input.html"><a href="routing-and-input.html#input-handling"><i class="fa fa-check"></i><b>3.2</b> Input Handling</a><ul>
<li class="chapter" data-level="3.2.1" data-path="routing-and-input.html"><a href="routing-and-input.html#the-request-object"><i class="fa fa-check"></i><b>3.2.1</b> The Request Object</a></li>
<li class="chapter" data-level="3.2.2" data-path="routing-and-input.html"><a href="routing-and-input.html#query-strings"><i class="fa fa-check"></i><b>3.2.2</b> Query Strings</a></li>
<li class="chapter" data-level="3.2.3" data-path="routing-and-input.html"><a href="routing-and-input.html#request-body"><i class="fa fa-check"></i><b>3.2.3</b> Request Body</a></li>
<li class="chapter" data-level="3.2.4" data-path="routing-and-input.html"><a href="routing-and-input.html#read-cookies"><i class="fa fa-check"></i><b>3.2.4</b> Cookies</a></li>
<li class="chapter" data-level="3.2.5" data-path="routing-and-input.html"><a href="routing-and-input.html#headers"><i class="fa fa-check"></i><b>3.2.5</b> Headers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rendering-and-output.html"><a href="rendering-and-output.html"><i class="fa fa-check"></i><b>4</b> Rendering Output</a><ul>
<li class="chapter" data-level="4.1" data-path="rendering-and-output.html"><a href="rendering-and-output.html#response-object"><i class="fa fa-check"></i><b>4.1</b> The Response Object</a></li>
<li class="chapter" data-level="4.2" data-path="rendering-and-output.html"><a href="rendering-and-output.html#serializers"><i class="fa fa-check"></i><b>4.2</b> Serializers</a><ul>
<li class="chapter" data-level="4.2.1" data-path="rendering-and-output.html"><a href="rendering-and-output.html#bypassing-serialization"><i class="fa fa-check"></i><b>4.2.1</b> Bypassing Serialization</a></li>
<li class="chapter" data-level="4.2.2" data-path="rendering-and-output.html"><a href="rendering-and-output.html#boxed-vs-unboxed-json"><i class="fa fa-check"></i><b>4.2.2</b> Boxed vs Unboxed JSON</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rendering-and-output.html"><a href="rendering-and-output.html#error-handling"><i class="fa fa-check"></i><b>4.3</b> Error Handling</a></li>
<li class="chapter" data-level="4.4" data-path="rendering-and-output.html"><a href="rendering-and-output.html#custom-serializers"><i class="fa fa-check"></i><b>4.4</b> Custom Serializers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="runtime.html"><a href="runtime.html"><i class="fa fa-check"></i><b>5</b> Runtime</a><ul>
<li class="chapter" data-level="5.1" data-path="runtime.html"><a href="runtime.html#execution-model"><i class="fa fa-check"></i><b>5.1</b> Execution Model</a></li>
<li class="chapter" data-level="5.2" data-path="runtime.html"><a href="runtime.html#managing-state"><i class="fa fa-check"></i><b>5.2</b> Managing State</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tips-tricks.html"><a href="tips-tricks.html"><i class="fa fa-check"></i><b>6</b> Tips &amp; Tricks</a><ul>
<li class="chapter" data-level="6.1" data-path="tips-tricks.html"><a href="tips-tricks.html#cookies"><i class="fa fa-check"></i><b>6.1</b> Cookies</a><ul>
<li class="chapter" data-level="6.1.1" data-path="tips-tricks.html"><a href="tips-tricks.html#setting-cookies"><i class="fa fa-check"></i><b>6.1.1</b> Setting Unencrypted Cookies</a></li>
<li class="chapter" data-level="6.1.2" data-path="tips-tricks.html"><a href="tips-tricks.html#encrypted-cookies"><i class="fa fa-check"></i><b>6.1.2</b> Setting Encrypted Cookies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hosting-and-security.html"><a href="hosting-and-security.html"><i class="fa fa-check"></i><b>7</b> Hosting &amp; Security</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="all-annotations.html"><a href="all-annotations.html"><i class="fa fa-check"></i><b>A</b> All Annotations</a></li>
<li class="chapter" data-level="B" data-path="preprocessors.html"><a href="preprocessors.html"><i class="fa fa-check"></i><b>B</b> Preprocessors</a></li>
<li class="chapter" data-level="C" data-path="programmatic-usage.html"><a href="programmatic-usage.html"><i class="fa fa-check"></i><b>C</b> Programmatic Usage</a></li>
<li class="chapter" data-level="D" data-path="citations.html"><a href="citations.html"><i class="fa fa-check"></i><b>D</b> Citations</a></li>
<li class="divider"></li>
<li><a href="https://www.netlify.com" target="_blank">Site hosting from Netlify</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating APIs in R with Plumber</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="quickstart" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Quickstart</h1>
<p>Plumber allows you to create APIs by merely decorating your existing R code with special annotations. The example below shows a file named <code>plumber.R</code> (the conventional name for Plumber APIs) which defines an API.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plumber.R</span>

<span class="co">#&#39; Echo the parameter that was sent in</span>
<span class="co">#&#39; @param msg The message to echo back.</span>
<span class="co">#&#39; @get /echo</span>
function(<span class="dt">msg=</span><span class="st">&quot;&quot;</span>){
  <span class="kw">list</span>(<span class="dt">msg =</span> <span class="kw">paste0</span>(<span class="st">&quot;The message is: &#39;&quot;</span>, msg, <span class="st">&quot;&#39;&quot;</span>))
}

<span class="co">#&#39; Plot out data from the iris dataset</span>
<span class="co">#&#39; @param spec If provided, filter the data to only this species (e.g. &#39;setosa&#39;)</span>
<span class="co">#&#39; @get /plot</span>
<span class="co">#&#39; @png</span>
function(spec){
  myData &lt;-<span class="st"> </span>iris
  title &lt;-<span class="st"> &quot;All Species&quot;</span>

  <span class="co"># Filter if the species was specified</span>
  if (!<span class="kw">missing</span>(spec)){
    title &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;Only the &#39;&quot;</span>, spec, <span class="st">&quot;&#39; Species&quot;</span>)
    myData &lt;-<span class="st"> </span><span class="kw">subset</span>(iris, Species ==<span class="st"> </span>spec)
  }

  <span class="kw">plot</span>(myData$Sepal.Length, myData$Petal.Length,
       <span class="dt">main=</span>title, <span class="dt">xlab=</span><span class="st">&quot;Sepal Length&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Petal Length&quot;</span>)
}</code></pre></div>
<p>This file defines two Plumber “endpoints.” One is hosted at the path <code>/echo</code> and simply echoes the message passed in; the other is hosted at the path <code>/plot</code> and returns an image showing a simple R plot.</p>
<p>If you haven’t installed <code>plumber</code> yet, see the <a href="index.html#installation">installation section</a>. Once you have <code>plumber</code> installed, you can use the <code>plumber::plumb</code> function to translate this R file into a Plumber API:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span>plumber::<span class="kw">plumb</span>(<span class="st">&quot;plumber.R&quot;</span>)</code></pre></div>
<p>The <code>pr</code> object now encapsulates all the logic represented in your <code>plumber.R</code> file. The next step is to bring the API to life using the <code>run</code> method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr$<span class="kw">run</span>()</code></pre></div>
<p>You should see a message about your API running on your computer on port <code>8000</code>. The API will continue running in your R session until you press the <code>Esc</code> key. If you’re running this code locally on your personal machine, you should be able to open <a href="http://localhost:8000/echo" class="uri">http://localhost:8000/echo</a> or <a href="http://localhost:8000/plot" class="uri">http://localhost:8000/plot</a> in a web browser to test your new API endpoints.</p>
<blockquote>
<p>If you’re using a tool like RStudio Server to run your R code on a remote machine, you should see the <a href="#networking">networking section</a> for help with visiting your API.</p>
</blockquote>
<p>The <code>/echo</code> endpoint should show output resembling the following.</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
  <span class="dt">&quot;msg&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;The message is: &#39;&#39;&quot;</span><span class="ot">]</span>
<span class="fu">}</span></code></pre></div>
<p>The <code>/plot</code> endpoint will show you a simple plot of some data from the iris dataset.</p>
<p><img src="apis-plumber_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>If you see something like the above: congratulations! You’ve just created your first Plumber API! You’ve already exercised your API from a web browser, but there’s nothing stopping you from leveraging this API from third-party tools or a client developed in R or any other programming language.</p>
<div id="specifying-the-inputs" class="section level2">
<h2><span class="header-section-number">2.1</span> Specifying the Inputs</h2>
<p>You may have noticed that the functions that define our endpoints accept parameters. These parameters allow us to customize the behavior of our endpoints. One of the ways to do this is using “query strings” which are a way of passing variables into an HTTP API. If you visit <a href="http://localhost:8000/plot?spec=setosa" class="uri">http://localhost:8000/plot?spec=setosa</a>, you should see a similar graph to the one you saw before, but now the dataset has been filtered to only include the “setosa” species in the iris dataset.</p>
<p><img src="apis-plumber_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>As you might have guessed, the <code>spec=setosa</code> portion of the URL sets the <code>spec</code> parameter to <code>setosa</code>. More details on how Plumber processes inputs are available in the <a href="routing-and-input.html#routing-and-input">Routing &amp; Input Chapter</a>.</p>
</div>
<div id="customizing-the-output" class="section level2">
<h2><span class="header-section-number">2.2</span> Customizing The Output</h2>
<p>In the previous example, you saw one endpoint that rendered into JSON and one that produced an image. Unless instructed otherwise, Plumber will attempt to render whatever your endpoint function returns as JSON. However, you can specify alternative “serializers” which instruct Plumber to render the output as some other format such as HTML (<code>@html</code>), PNG (<code>@png</code>), or JPEG (<code>@jpeg</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; @get /hello</span>
<span class="co">#&#39; @html</span>
function(){
  <span class="st">&quot;&lt;html&gt;&lt;h1&gt;hello world&lt;/h1&gt;&lt;/html&gt;&quot;</span>
}</code></pre></div>
<p>This endpoint would produce something like the following, when visited. It also sets the appropriate <code>Content-Type</code> header so that a browser that visits this page would know to render the result as HTML.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;&lt;h1&gt;</span>hello world<span class="kw">&lt;/h1&gt;&lt;/html&gt;</span></code></pre></div>
<p>You can even provide your own custom serializers and define how to translate the R object produced by your endpoint into the bits that will be produce Plumber’s HTTP response.</p>
<p>You can find more details in the <a href="rendering-and-output.html#rendering-and-output">Rendering &amp; Output chapter</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="routing-and-input.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/trestletech/apis-plumber/edit/master/02-quickstart.Rmd",
"text": "Edit"
},
"download": ["apis-plumber.pdf", "apis-plumber.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
