<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Creating APIs in R with Plumber</title>
  <meta name="description" content="Use the plumber R package to create HTTP APIs in R.">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="Creating APIs in R with Plumber" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Use the plumber R package to create HTTP APIs in R." />
  <meta name="github-repo" content="trestletech/apis-plumber" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Creating APIs in R with Plumber" />
  
  <meta name="twitter:description" content="Use the plumber R package to create HTTP APIs in R." />
  

<meta name="author" content="Jeff Allen">


<meta name="date" content="2017-06-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="runtime.html">
<link rel="next" href="hosting-and-security.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Creating APIs in R with Plumber</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#web-apis"><i class="fa fa-check"></i><b>1.1</b> Web APIs</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quickstart.html"><a href="quickstart.html"><i class="fa fa-check"></i><b>2</b> Quickstart</a><ul>
<li class="chapter" data-level="2.1" data-path="quickstart.html"><a href="quickstart.html#specifying-the-inputs"><i class="fa fa-check"></i><b>2.1</b> Specifying the Inputs</a></li>
<li class="chapter" data-level="2.2" data-path="quickstart.html"><a href="quickstart.html#customizing-the-output"><i class="fa fa-check"></i><b>2.2</b> Customizing The Output</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="routing-and-input.html"><a href="routing-and-input.html"><i class="fa fa-check"></i><b>3</b> Routing &amp; Input</a><ul>
<li class="chapter" data-level="3.1" data-path="routing-and-input.html"><a href="routing-and-input.html#routing"><i class="fa fa-check"></i><b>3.1</b> Routing</a><ul>
<li class="chapter" data-level="3.1.1" data-path="routing-and-input.html"><a href="routing-and-input.html#endpoints"><i class="fa fa-check"></i><b>3.1.1</b> Endpoints</a></li>
<li class="chapter" data-level="3.1.2" data-path="routing-and-input.html"><a href="routing-and-input.html#dynamic-routes"><i class="fa fa-check"></i><b>3.1.2</b> Dynamic Routes</a></li>
<li class="chapter" data-level="3.1.3" data-path="routing-and-input.html"><a href="routing-and-input.html#typed-dynamic-routes"><i class="fa fa-check"></i><b>3.1.3</b> Typed Dynamic Routes</a></li>
<li class="chapter" data-level="3.1.4" data-path="routing-and-input.html"><a href="routing-and-input.html#filters"><i class="fa fa-check"></i><b>3.1.4</b> Filters</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="routing-and-input.html"><a href="routing-and-input.html#input-handling"><i class="fa fa-check"></i><b>3.2</b> Input Handling</a><ul>
<li class="chapter" data-level="3.2.1" data-path="routing-and-input.html"><a href="routing-and-input.html#the-request-object"><i class="fa fa-check"></i><b>3.2.1</b> The Request Object</a></li>
<li class="chapter" data-level="3.2.2" data-path="routing-and-input.html"><a href="routing-and-input.html#query-strings"><i class="fa fa-check"></i><b>3.2.2</b> Query Strings</a></li>
<li class="chapter" data-level="3.2.3" data-path="routing-and-input.html"><a href="routing-and-input.html#request-body"><i class="fa fa-check"></i><b>3.2.3</b> Request Body</a></li>
<li class="chapter" data-level="3.2.4" data-path="routing-and-input.html"><a href="routing-and-input.html#read-cookies"><i class="fa fa-check"></i><b>3.2.4</b> Cookies</a></li>
<li class="chapter" data-level="3.2.5" data-path="routing-and-input.html"><a href="routing-and-input.html#headers"><i class="fa fa-check"></i><b>3.2.5</b> Headers</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rendering-and-output.html"><a href="rendering-and-output.html"><i class="fa fa-check"></i><b>4</b> Rendering Output</a><ul>
<li class="chapter" data-level="4.1" data-path="rendering-and-output.html"><a href="rendering-and-output.html#response-object"><i class="fa fa-check"></i><b>4.1</b> The Response Object</a></li>
<li class="chapter" data-level="4.2" data-path="rendering-and-output.html"><a href="rendering-and-output.html#serializers"><i class="fa fa-check"></i><b>4.2</b> Serializers</a><ul>
<li class="chapter" data-level="4.2.1" data-path="rendering-and-output.html"><a href="rendering-and-output.html#bypassing-serialization"><i class="fa fa-check"></i><b>4.2.1</b> Bypassing Serialization</a></li>
<li class="chapter" data-level="4.2.2" data-path="rendering-and-output.html"><a href="rendering-and-output.html#boxed-vs-unboxed-json"><i class="fa fa-check"></i><b>4.2.2</b> Boxed vs Unboxed JSON</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rendering-and-output.html"><a href="rendering-and-output.html#error-handling"><i class="fa fa-check"></i><b>4.3</b> Error Handling</a></li>
<li class="chapter" data-level="4.4" data-path="rendering-and-output.html"><a href="rendering-and-output.html#custom-serializers"><i class="fa fa-check"></i><b>4.4</b> Custom Serializers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="runtime.html"><a href="runtime.html"><i class="fa fa-check"></i><b>5</b> Runtime</a><ul>
<li class="chapter" data-level="5.1" data-path="runtime.html"><a href="runtime.html#execution-model"><i class="fa fa-check"></i><b>5.1</b> Execution Model</a></li>
<li class="chapter" data-level="5.2" data-path="runtime.html"><a href="runtime.html#managing-state"><i class="fa fa-check"></i><b>5.2</b> Managing State</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tips-tricks.html"><a href="tips-tricks.html"><i class="fa fa-check"></i><b>6</b> Tips &amp; Tricks</a><ul>
<li class="chapter" data-level="6.1" data-path="tips-tricks.html"><a href="tips-tricks.html#cookies"><i class="fa fa-check"></i><b>6.1</b> Cookies</a><ul>
<li class="chapter" data-level="6.1.1" data-path="tips-tricks.html"><a href="tips-tricks.html#setting-cookies"><i class="fa fa-check"></i><b>6.1.1</b> Setting Unencrypted Cookies</a></li>
<li class="chapter" data-level="6.1.2" data-path="tips-tricks.html"><a href="tips-tricks.html#encrypted-cookies"><i class="fa fa-check"></i><b>6.1.2</b> Setting Encrypted Cookies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="hosting-and-security.html"><a href="hosting-and-security.html"><i class="fa fa-check"></i><b>7</b> Hosting &amp; Security</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="all-annotations.html"><a href="all-annotations.html"><i class="fa fa-check"></i><b>A</b> All Annotations</a></li>
<li class="chapter" data-level="B" data-path="preprocessors.html"><a href="preprocessors.html"><i class="fa fa-check"></i><b>B</b> Preprocessors</a></li>
<li class="chapter" data-level="C" data-path="programmatic-usage.html"><a href="programmatic-usage.html"><i class="fa fa-check"></i><b>C</b> Programmatic Usage</a></li>
<li class="chapter" data-level="D" data-path="citations.html"><a href="citations.html"><i class="fa fa-check"></i><b>D</b> Citations</a></li>
<li class="divider"></li>
<li><a href="https://www.netlify.com" target="_blank">Site hosting from Netlify</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating APIs in R with Plumber</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tips-tricks" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Tips &amp; Tricks</h1>
<p>//TODO - Debugging - Testing - Managing State - In-memory Environments and &lt;&lt;-. BAD, STATELESS - Cookies - Concurrent programming (if multiple proc’s) - Organizing Large Applications - Swagger</p>
<div id="cookies" class="section level2">
<h2><span class="header-section-number">6.1</span> Cookies</h2>
<p>//TODO - see <a href="https://plumber.trestletech.com/docs/sessions/" class="uri">https://plumber.trestletech.com/docs/sessions/</a> for a good start – the last section on that page might be good here.</p>
<div id="setting-cookies" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Setting Unencrypted Cookies</h3>
<p>HTTP APIs don’t implicitly contain a notion of a “session.” Without some additional information, Plumber has no way of ascertaining whether or not two HTTP requests that come in are associated with the same user. Cookies offer a way to commission the client to store some state on your behalf so that selected data can outlive a single HTTP request.</p>
<p>Plumber can both set and receive cookies. For details on setting cookies, see the <a href="tips-tricks.html#setting-cookies">Setting Cookies section</a>. The API below will send you a random letter, but it remembers your preferences on whether you like capitalized or lower-case letters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; @put /preferences</span>
function(res, capital){
  if (<span class="kw">missing</span>(capital)){
    <span class="kw">stop</span>(<span class="st">&quot;You must specify a value for the &#39;capital&#39; preference.&quot;</span>)
  }
  res$<span class="kw">setCookie</span>(<span class="st">&quot;capitalize&quot;</span>, capital)
}

<span class="co">#&#39; @get /letter</span>
function(req) {
  <span class="kw">print</span>(<span class="kw">ls</span>(req))
  capitalize &lt;-<span class="st"> </span>req$cookies$capitalize

  <span class="co"># Default to lower-case unless user preference is capitalized</span>
  alphabet &lt;-<span class="st"> </span>letters

  <span class="co"># The capitalize cookie will initially be empty (NULL)</span>
  if (!<span class="kw">is.null</span>(capitalize) &amp;&amp;<span class="st"> </span>capitalize ==<span class="st"> &quot;1&quot;</span>){
    alphabet &lt;-<span class="st"> </span>LETTERS
  }

  <span class="kw">list</span>(
    <span class="dt">letter =</span> <span class="kw">sample</span>(alphabet, <span class="dv">1</span>)
  )
}</code></pre></div>
<p>Since we need to craft a <code>PUT</code> request to test this API, we’ll use <code>curl</code> on the command line to test it. We can start by visiting the <code>/letter</code> endpoint and we’ll see that the API defaults to a lower-case alphabet. <code>curl http://localhost:8000/letter</code></p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="ot">[</span><span class="dv">1</span><span class="ot">]</span> <span class="er">&quot;cookies&quot;</span>
<span class="fu">{</span>
  <span class="dt">&quot;letter&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;c&quot;</span><span class="ot">]</span>
<span class="fu">}</span></code></pre></div>
<p>If we send a <code>PUT</code> request and specify the <code>capital</code> parameter, a cookie will be set on the client which will allow the server to accommodate our preference in future requests. In <code>curl</code>, you need to specify a file in which you want to save these cookies using the <code>-c</code> option. This is a good reminder that clients handle cookies differently – some won’t support them at all – so be sure that the clients you intend to support with your API play nicely with cookies if you want to use them.</p>
<p>To send a <code>PUT</code> request, setting the parameter <code>capital</code> to <code>1</code>, we could invoke: <code>curl -c cookies.txt -X PUT --data 'capital=1' &quot;http://localhost:8000/preferences&quot;</code>. If you print out the <code>cookies.txt</code> file, you should now see that it contains a single cookie called <code>capitalize</code> with a value of <code>1</code>.</p>
<p>We can make another <code>GET</code> request to <code>/letter</code> to see if it accommodates our preferences. But we’ll need to tell <code>curl</code> to use the cookies file we just created when sending this request using the <code>-b</code> switch: <code>curl -b cookies.txt http://localhost:8000/letter</code>. You should now see that the API is returning a random capitalized letter.</p>
<p>This is a simple example showing how to persist user preferences across HTTP requests using cookies. But be aware that the client has the ability to modify or fabricate the cookies that they send to your API. So storing preferences that the user themselves provided in a cookie is not a concern. Storing something with security implications like the level of permissions this client has on your API, however, would be; a malicious user would just need to modify the role saved in their cookie in order to trick your API into giving them more permissions than it should.</p>
<p>There are two common work-arounds to this concern. You can simply store a long (cryptographically) random identifier in the user’s cookie, and have some mapping on the server that allows you to lookup the session associated with that random ID. Alternatively, you could use signed/encrypted cookies, as detailed <a href="tips-tricks.html#encrypted-cookies">below</a>.</p>
</div>
<div id="encrypted-cookies" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Setting Encrypted Cookies</h3>
<p>//TODO: See <a href="https://plumber.trestletech.com/docs/sessions/" class="uri">https://plumber.trestletech.com/docs/sessions/</a> – it’s got a pretty good start</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="runtime.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="hosting-and-security.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/trestletech/apis-plumber/edit/master/06-tips-and-tricks.Rmd",
"text": "Edit"
},
"download": ["apis-plumber.pdf", "apis-plumber.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
